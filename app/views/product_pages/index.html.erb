<%# Product Pages Index - List of monitored PDPs %>

<div class="page-header">
  <div style="display: flex; justify-content: space-between; align-items: flex-start;">
    <div>
      <h1 class="page-title">Monitored Pages</h1>
      <p class="page-subtitle">
        <%= @product_pages.count %> of <%= @shop.shop_setting&.max_monitored_pages || 5 %> pages monitored
      </p>
    </div>
    <div style="display: flex; gap: 12px;">
      <%= link_to root_path(host: @host), class: "button-secondary" do %>
        ‚Üê Back to Dashboard
      <% end %>
      <% if @can_add_more %>
        <%= link_to new_product_page_path(host: @host), class: "button-primary" do %>
          Add Product Page
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<div class="issues-list">
  <% if @product_pages.any? %>
    <% @product_pages.each do |page| %>
      <div class="issue-item" style="cursor: default;">
        <div class="issue-severity <%= page.status %>"></div>
        <div class="issue-content">
          <%= link_to product_page_path(page, host: @host), style: "text-decoration: none; color: inherit;" do %>
            <p class="issue-title"><%= page.title %></p>
            <p class="issue-meta">
              <%= page.handle %> ‚Ä¢ 
              <% if page.last_scanned_at %>
                Last scanned <%= time_ago_in_words(page.last_scanned_at) %> ago
              <% else %>
                Never scanned
              <% end %>
              <% if page.high_severity_issues_count > 0 %>
                ‚Ä¢ <%= page.high_severity_issues_count %> critical issue<%= page.high_severity_issues_count > 1 ? 's' : '' %>
              <% end %>
            </p>
          <% end %>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
          <span class="badge badge-<%= page.status == 'healthy' ? 'healthy' : (page.status == 'critical' ? 'critical' : (page.status == 'warning' ? 'warning' : 'pending')) %>">
            <%= page.status.capitalize %>
          </span>
          <%= link_to product_page_path(page, host: @host), class: "button-secondary" do %>
            View
          <% end %>
          <%= button_to rescan_product_page_path(page, host: @host), method: :post, class: "button-secondary", form: { style: "display: inline;" } do %>
            Rescan
          <% end %>
          <%= button_to product_page_path(page, host: @host), method: :delete, class: "button-secondary", form: { style: "display: inline;" }, data: { confirm: "Remove #{page.title} from monitoring?" } do %>
            Remove
          <% end %>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="empty-state">
      <div class="empty-state-icon">üì¶</div>
      <h3 class="empty-state-title">No product pages monitored yet</h3>
      <p class="empty-state-description">Add up to 5 product pages to start monitoring their health.</p>
      <%= link_to "Add Product Page", new_product_page_path(host: @host), class: "button-primary" %>
    </div>
  <% end %>
</div>
