<%# Settings Page - Using Shopify App Bridge Forms with Save Bar %>

<s-page heading="Settings">
  <s-link slot="breadcrumb-actions" href="<%= root_path(host: @host) %>">Dashboard</s-link>
</s-page>

<form 
  action="<%= settings_path(host: @host) %>" 
  method="post" 
  data-save-bar
  data-discard-confirmation
  id="settings-form"
>
  <input type="hidden" name="_method" value="patch" />
  <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>" />
  
  <!-- Alert Settings -->
  <div class="stat-card mb-lg">
    <h3 class="stat-card-section-title stat-card-section-title--lg">Alert Preferences</h3>
    
    <div class="settings-section">
      <label class="settings-checkbox-label">
        <input 
          type="checkbox" 
          name="shop_setting[email_alerts_enabled]" 
          value="1"
          <%= @settings.email_alerts_enabled ? 'checked' : '' %>
          class="settings-checkbox"
        />
        <input type="hidden" name="shop_setting[email_alerts_enabled]" value="0" />
        <div>
          <p class="settings-label-title">Email alerts</p>
          <p class="settings-label-description">
            Receive email notifications when high-severity issues are detected
          </p>
        </div>
      </label>
    </div>
    
    <div class="settings-section">
      <label class="settings-checkbox-label">
        <input 
          type="checkbox" 
          name="shop_setting[admin_alerts_enabled]" 
          value="1"
          <%= @settings.admin_alerts_enabled ? 'checked' : '' %>
          class="settings-checkbox"
        />
        <input type="hidden" name="shop_setting[admin_alerts_enabled]" value="0" />
        <div>
          <p class="settings-label-title">Shopify admin notifications</p>
          <p class="settings-label-description">
            Receive notifications in your Shopify admin dashboard
          </p>
        </div>
      </label>
    </div>
    
    <div>
      <label for="alert_email" class="settings-field-label">
        Alert email address
      </label>
      <input 
        type="email"
        id="alert_email"
        name="shop_setting[alert_email]"
        placeholder="<%= @shop.email || @shop.shopify_domain %>"
        value="<%= @settings.alert_email %>"
        class="settings-input"
      />
      <p class="settings-help-text">
        <% if @shop.email.present? %>
          Leave blank to use your shop's email (<%= @shop.email %>)
        <% else %>
          Leave blank to use your store's default email
        <% end %>
      </p>
    </div>
  </div>
  
  <!-- Scan Settings -->
  <div class="stat-card mb-lg">
    <h3 class="stat-card-section-title stat-card-section-title--lg">Scan Settings</h3>
    
    <div>
      <label for="scan_frequency" class="settings-field-label">
        Scan frequency
      </label>
      <select 
        id="scan_frequency"
        name="shop_setting[scan_frequency]"
        class="settings-select"
      >
        <option value="daily" <%= @settings.scan_frequency == 'daily' ? 'selected' : '' %>>Daily (recommended)</option>
        <option value="weekly" <%= @settings.scan_frequency == 'weekly' ? 'selected' : '' %>>Weekly</option>
      </select>
      <p class="settings-help-text">
        How often to automatically scan your monitored pages
      </p>
    </div>
  </div>
  
</form>
